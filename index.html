<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>63マススライドパズル</title>
  <style>
    .puzzle-container {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      gap: 2px;
    }

    .puzzle-piece {
      width: 50px;
      height: 50px;
      background-color: #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="puzzle-container" id="puzzle-container"></div>

<script>
  const puzzleContainer = document.getElementById('puzzle-container');

  // パズルのサイズ
  const gridSize = 8;

  // パズルの初期状態
  const initialPuzzle = Array.from({ length: gridSize * gridSize - 1 }, (_, index) => index + 1);

  // シャッフル関数
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  // パズルの初期化
  function initializePuzzle() {
    puzzleContainer.innerHTML = '';

    const shuffledPuzzle = [...initialPuzzle];
    shuffleArray(shuffledPuzzle);

    shuffledPuzzle.forEach((number, index) => {
      const piece = document.createElement('div');
      piece.classList.add('puzzle-piece');
      piece.textContent = number;
      piece.addEventListener('click', () => handlePieceClick(number));

      puzzleContainer.appendChild(piece);
    });
  }

  // ピースがクリックされたときの処理
  function handlePieceClick(number) {
    const emptyIndex = initialPuzzle.indexOf(gridSize * gridSize - 1);
    const clickedIndex = initialPuzzle.indexOf(number);

    if (isAdjacent(emptyIndex, clickedIndex)) {
      [initialPuzzle[emptyIndex], initialPuzzle[clickedIndex]] = [initialPuzzle[clickedIndex], initialPuzzle[emptyIndex]];
      initializePuzzle();
    }
  }

  // ２つのピースが隣り合っているかを判定
  function isAdjacent(index1, index2) {
    const row1 = Math.floor(index1 / gridSize);
    const col1 = index1 % gridSize;
    const row2 = Math.floor(index2 / gridSize);
    const col2 = index2 % gridSize;

    return (Math.abs(row1 - row2) === 1 && col1 === col2) || (Math.abs(col1 - col2) === 1 && row1 === row2);
  }

  // ページロード時に初期化
  window.onload = initializePuzzle;
</script>

</body>
</html>