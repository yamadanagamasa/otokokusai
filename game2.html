<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>縦シューティングゲーム</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
            background-color: #000;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 50,
            height: 50,
            speed: 6,
            lastBulletTime: 0
        };

        let bullets = [];
        let enemies = [];

        function spawnEnemy() {
            const enemy = {
                x: Math.random() * canvas.width,
                y: 0,
                width: 30,
                height: 30,
                speed: Math.random() * 4 + 2,
                lastBulletTime: 0
            };
            enemies.push(enemy);
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "#00ff00"; // プレイヤーの色を緑に変更
            ctx.fillRect(player.x, player.y, player.width, player.height);

            ctx.fillStyle = "#ff0000"; // 弾の色を赤に変更
            bullets.forEach(bullet => {
                ctx.fillRect(bullet.x, bullet.y, 5, 15);
            });

            ctx.fillStyle = "#ffff00"; // 敵の色を黄色に変更
            enemies.forEach(enemy => {
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });

            bullets.forEach(bullet => {
                bullet.y -= 10;
            });

            enemies.forEach(enemy => {
                enemy.y += enemy.speed;
            });

            bullets.forEach((bullet, bulletIndex) => {
                enemies.forEach((enemy, enemyIndex) => {
                    if (
                        bullet.x < enemy.x + enemy.width &&
                        bullet.x + 5 > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + 15 > enemy.y
                    ) {
                        bullets.splice(bulletIndex, 1);
                        enemies.splice(enemyIndex, 1);
                    }
                });
            });

            enemies.forEach((enemy, enemyIndex) => {
                if (
                    player.x < enemy.x + enemy.width &&
                    player.x + player.width > enemy.x &&
                    player.y < enemy.y + enemy.height &&
                    player.y + player.height > enemy.y
                ) {
                    alert("ゲームオーバー");
                    document.location.reload();
                }
            });

            if (Math.random() < 0.03) {
                spawnEnemy();
            }

            // 弾を定期的に発射
            const currentTime = Date.now();
            if (currentTime - player.lastBulletTime > 500) {
                const bullet = {
                    x: player.x + player.width / 2 - 2.5,
                    y: player.y
                };
                bullets.push(bullet);
                player.lastBulletTime = currentTime;
            }

            enemies.forEach(enemy => {
                if (currentTime - enemy.lastBulletTime > Math.random() * 2000 + 1000) {
                    const bullet = {
                        x: enemy.x + enemy.width / 2 - 2.5,
                        y: enemy.y + enemy.height
                    };
                    bullets.push(bullet);
                    enemy.lastBulletTime = currentTime;
                }
            });

            requestAnimationFrame(gameLoop);
        }

        gameLoop();

        // マウスの座標にプレイヤーを移動させる
        canvas.addEventListener("mousemove", event => {
            const mouseX = event.clientX - canvas.getBoundingClientRect().left;
            player.x = mouseX - player.width / 2;
        });

    </script>
</body>
</html>
